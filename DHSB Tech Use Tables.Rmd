---
title: "DHSB Technology Tables"
author: "Adam Northrup, Data Manager, ETAC"
date: "March 11, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE, 
                      warning = FALSE, message = FALSE)
#####Read libraries
library(tidyverse)
library(sjlabelled)
library(rio)
library(openxlsx)
library(kableExtra)

#####Load data
setwd("C:/Users/ANorthrup/Documents/ETAC_DHSB")
load("acasi.RData")
```

```{r}
tech <- acasi2 %>%
  select(SITE1, SITE_RC, PID, starts_with("MTU"), starts_with("S56"))
```

```{r}
x <- tech %>%
  select(matches("S56_1[[:alpha:]]+"), -S56_1S)
devices <- tibble(Text = c("Cell phone", "Tablet", "Other mobile device", 
                           "Laptop", "Desktop computer", "Other", 
                           "Not applicable"),
                  Variable = names(x))
freqCols <- x %>% 
  map_int(sum) %>%
  sort(., decreasing = TRUE) %>%
  names()
x <- x %>%
  mutate(Other = rowSums(select(., freqCols[4:length(freqCols)]))) %>%
  mutate(Other = if_else(Other > 0, 1L, 0L))
x %>% 
  select(freqCols[1:3], Other) %>% 
  {
    bind_cols(map_int(., sum) %>% 
                as.data.frame() %>%
                rownames_to_column("Variable"),
              map_dbl(., mean) %>%
                as.data.frame())
  } %>%
  setNames(c("Variable", "Count", "Percent")) %>%
  mutate(Percent = scales::percent(Percent, accuracy = 0.1),
         Variable = c(devices$Text[
           map_int(Variable[1:3], ~which(devices$Variable %in% .))
           ],
           "Other"))
```